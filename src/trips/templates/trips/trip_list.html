{% extends 'dashboard/base.html' %}

{% load crispy_forms_tags %}

{% block title %}My Trips - TripSync{% endblock %}

{% block content %}
<!-- HEADER -->
<div class="text-center mb-5">
    <h3 class="text-uppercase mb-4" style="font-family: 'Montserrat', sans-serif; font-weight: 700;">
        My Trips
    </h3>

    <!-- BUTTONS ROW -->
    <div class="d-flex justify-content-center align-items-start gap-3">
        <!-- CREATE TRIP (left) -->
        <div>
            <a href="{% url 'trip-create' %}" class="btn" style="background-color: rgba(255,212,64,0.98); color: #100808; padding: 8px 20px; font-weight: bold; border-radius: 5px; text-transform: uppercase; font-size: 0.85rem;">
                <i class="fas fa-plus"></i> Create Trip
            </a>
        </div>

        <!-- INVITATIONS BUTTONS (right, stacked) -->
        <div class="d-flex flex-column gap-2">
            <a href="{% url 'trip-invite-list' %}" class="btn" style="background-color: rgba(63,106,71,0.74); color: white; padding: 6px 18px; font-weight: bold; border-radius: 5px; text-transform: uppercase; font-size: 0.75rem;">
                <i class="fas fa-envelope"></i> My Invitations
            </a>
            <a href="{% url 'trip-invite-sent' %}" class="btn" style="background-color: rgba(197,172,66,0.98); color: white; padding: 6px 18px; font-weight: bold; border-radius: 5px; text-transform: uppercase; font-size: 0.75rem;">
                <i class="fas fa-paper-plane"></i> Sent Invitations
            </a>
        </div>
    </div>
</div>

{% if trips %}
    <!-- OWNER TRIPS -->
<div class="text-center mb-4">
    <h4 class="text-capitalize" style="font-family: 'Montserrat', sans-serif; font-weight: 700;">
        <i class="fas fa-crown text-warning"></i> Owner
    </h4>
</div>

<div class="d-flex flex-wrap justify-content-center gap-4 mb-5">
    {% for trip in trips %}
        {% if trip.owner == user %}
            <div class="card shadow" style="width: 350px;">
                <div class="card-body d-flex flex-column">
                    <a href="{% url 'trip-detail' trip.pk %}" class="text-decoration-none text-dark">
                        <h5 class="text-capitalize mb-3" style="font-family: 'Montserrat', sans-serif; font-weight: 700;">
                            {{ trip.title }}
                        </h5>
                    </a>

                    <p class="text-muted mb-2">
                        <i class="fas fa-map-marker-alt"></i> {{ trip.destination }}
                    </p>
                    <p class="text-muted mb-2">
                        <i class="fas fa-calendar"></i> {{ trip.start_date|date:"M d, Y" }} - {{ trip.end_date|date:"M d, Y" }}
                    </p>
                    <p class="text-muted mb-3">
                        <i class="fas fa-users"></i> Members: {{ trip.members.count }}
                    </p>

                    <div class="mt-auto d-flex flex-column gap-2">
                        <!-- Row 1: View Details + Edit Trip -->
                        <div class="d-flex gap-2">
                            <a href="{% url 'trip-detail' trip.pk %}" class="btn btn-sm" style="background-color: rgba(63,106,71,0.74); color: white; font-weight: bold; flex: 1;">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                            <a href="{% url 'trip-update' trip.pk %}" class="btn btn-sm btn-outline-dark" style="flex: 1;">
                                <i class="fas fa-edit"></i> Edit Trip
                            </a>
                        </div>

                        <!-- Row 2: See Notes + See Packing Lists + Shopping -->
                        <div class="d-flex gap-2">
                            <a href="{% url 'note-list' trip.pk %}" class="btn btn-sm btn-outline-secondary" style="flex: 1;">
                                <i class="fas fa-sticky-note"></i> Notes
                            </a>
                            <a href="{% url 'packing-lists-for-trip' trip.pk %}" class="btn btn-sm btn-outline-secondary" style="flex: 1;">
                                <i class="fas fa-suitcase"></i> Packing
                            </a>
                            {% if trip.has_shopping_list %}
                                <a href="{% url 'shopping-list-details' trip.shopping_list.pk %}" class="btn btn-sm btn-outline-secondary" style="flex: 1;">
                                    <i class="fas fa-shopping-cart"></i> Shopping
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endfor %}
</div>

    <!-- MEMBER TRIPS -->
<div class="text-center mb-4">
    <h4 class="text-capitalize" style="font-family: 'Montserrat', sans-serif; font-weight: 700;">
        <i class="fas fa-users"></i> Member
    </h4>
</div>

<div class="d-flex flex-wrap justify-content-center gap-4 mb-5">
    {% for trip in trips %}
        {% if trip.owner != user %}
            <div class="card shadow" style="width: 350px;">
                <div class="card-body d-flex flex-column">
                    <a href="{% url 'trip-detail' trip.pk %}" class="text-decoration-none text-dark">
                        <h5 class="text-capitalize mb-3" style="font-family: 'Montserrat', sans-serif; font-weight: 700;">
                            {{ trip.title }}
                        </h5>
                    </a>

                    <p class="text-muted mb-2">
                        <i class="fas fa-map-marker-alt"></i> {{ trip.destination }}
                    </p>
                    <p class="text-muted mb-2">
                        <i class="fas fa-calendar"></i> {{ trip.start_date|date:"M d, Y" }} - {{ trip.end_date|date:"M d, Y" }}
                    </p>
                    <p class="text-muted mb-2">
                        <i class="fas fa-users"></i> Members: {{ trip.members.count }}
                    </p>
                    <p class="text-muted mb-3">
                        <i class="fas fa-user"></i> By {{ trip.owner.username }}
                    </p>

                    <div class="mt-auto d-flex flex-column gap-2">
                        <!-- Row 1: View Details -->
                        <a href="{% url 'trip-detail' trip.pk %}" class="btn btn-sm" style="background-color: rgba(63,106,71,0.74); color: white; font-weight: bold;">
                            <i class="fas fa-eye"></i> View Details
                        </a>

                        <!-- Row 2: See Notes + See Packing Lists + Shopping -->
                        <div class="d-flex gap-2">
                            <a href="{% url 'note-list' trip.pk %}" class="btn btn-sm btn-outline-secondary" style="flex: 1;">
                                <i class="fas fa-sticky-note"></i> Notes
                            </a>
                            <a href="{% url 'packing-lists-for-trip' trip.pk %}" class="btn btn-sm btn-outline-secondary" style="flex: 1;">
                                <i class="fas fa-suitcase"></i> Packing
                            </a>
                            {% if trip.has_shopping_list %}
                                <a href="{% url 'shopping-list-details' trip.shopping_list.pk %}" class="btn btn-sm btn-outline-secondary" style="flex: 1;">
                                    <i class="fas fa-shopping-cart"></i> Shopping
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endfor %}
</div>

{% else %}
    <!-- EMPTY STATE -->
    <div class="text-center py-5">
        <i class="fas fa-suitcase" style="font-size: 4rem; color: #ccc;"></i>
        <p class="text-muted mt-3">You don't have any trips yet.</p>
        <a href="{% url 'trip-create' %}" class="btn" style="background-color: rgba(63,106,71,0.74); color: white; padding: 12px 30px; font-weight: bold; border-radius: 5px; text-transform: uppercase;">
            Create Your First Trip
        </a>
    </div>
{% endif %}

{% endblock %}